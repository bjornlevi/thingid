{% extends "base.html" %}
{% block content %}
<section class="hero">
    <div>
        <p class="eyebrow">Þingmannalisti</p>
        <h1>Þingmenn eftir flokkum</h1>
        <p class="lede">Skoðaðu þingmenn eftir flokkum og smelltu til að sjá mætingu, ræður og opinberar síður.</p>
    </div>
</section>

<section class="stack">
    {% if error %}
        <p class="text-danger">{{ error }}</p>
    {% endif %}
    <div class="filter-row">
        <label class="filter-label" for="party-filter">Þingflokkur</label>
        <select id="party-filter" class="filter-select">
            <option value="">Allir flokkar</option>
            {% for party, members in parties.items() %}
                <option value="{{ party }}">{{ party }} ({{ members|length }})</option>
            {% endfor %}
        </select>
    </div>
    {% for party, members in parties.items() %}
        <details class="panel party-panel" data-party="{{ party }}" open>
            <summary>{{ party }}</summary>
            <div class="panel-body">
                <div class="member-grid">
                    {% for m in members %}
                        <div class="member-card">
                            <div class="member-id">
                                <a href="{{ url_for('main.member_detail', member_id=m.attr_id, **session_params) }}">
                                    <img src="https://www.althingi.is/myndir/mynd/thingmenn/{{ m.attr_id }}/org/mynd.jpg" alt="{{ m.leaf_nafn }}" loading="lazy" onerror="this.style.display='none';">
                                </a>
                            </div>
                            <div class="member-meta">
                                <strong><a href="{{ url_for('main.member_detail', member_id=m.attr_id, **session_params) }}">{{ m.leaf_nafn }}</a></strong>
                                {% if m.current_seat %}
                                    <span class="pill subtle">{{ m.current_seat.party_name or "Óflokkaður" }}{% if m.current_seat.type %} · {{ m.current_seat.type }}{% endif %}</span>
                                    {% if m.current_seat.inn or m.current_seat.ut %}
                                        <span class="muted">Sæti: {{ m.current_seat.inn or "?" }} — {{ m.current_seat.ut or "nú" }}</span>
                                    {% endif %}
                                    {% if m.current_seat.kjordaemi_name %}
                                        <span class="muted">Kjördæmi: {{ m.current_seat.kjordaemi_name }}</span>
                                    {% endif %}
                                {% elif m.leaf_faedingardagur %}
                                    <span class="muted">Fædd/ur {{ m.leaf_faedingardagur }}</span>
                                {% endif %}
                                {% if m.vote_att_pct is not none %}
                                    <span class="pill neutral">Mæting í atkvæðagreiðslur: {{ "%.1f"|format(m.vote_att_pct) }}%</span>
                                {% endif %}
                                {% if m.committee_att_pct is not none %}
                                    <span class="pill neutral">Mæting á nefndarfundi: {{ "%.1f"|format(m.committee_att_pct) }}%</span>
                                {% endif %}
                            </div>
                            <div class="links">
                                <a class="pill link" href="{{ url_for('main.member_attendance', member_id=m.attr_id, **session_params) }}">Sjá mætingarskýrslu</a>
                                {% if m.speech_count %}
                                    <a class="pill link" href="{{ url_for('main.member_speeches', member_id=m.attr_id, **session_params) }}">Þingræður ({{ m.speech_count }})</a>
                                {% endif %}
                            </div>
                            {% if not m.is_pseudo %}
                                <div class="links">
                                    {% if m.attr_id %}
                                        <a href="https://www.althingi.is/altext/cv/is/cv/{{ m.cv_slug }}/{{ m.attr_id }}/?nfaerslunr={{ m.attr_id }}">Þingstörf</a>
                                        <a href="https://www.althingi.is/altext/cv/is/hagsmunaskra/?nfaerslunr={{ m.attr_id }}">Hagsmunir</a>
                                        <a href="https://www.althingi.is/altext/cv/is/nefndaseta/{{ m.cv_slug }}/{{ m.attr_id }}/?nfaerslunr={{ m.attr_id }}">Nefndaseta</a>
                                    {% endif %}
                                </div>
                            {% endif %}
                            {% if m.issues %}
                                <details class="issue-list">
                                    <summary>Þingmál ({{ m.issues|length }})</summary>
                                    <ul class="list">
                                        {% for is in m.issues %}
                                            <li>
                                                <div class="row">
                                                    <strong>Mál {{ is.malnr }}</strong>
                                                    {% if is.answer %}<a href="{{ is.answer }}">Svar</a>{% endif %}
                                                </div>
                                                <div class="row">
                                                    <a class="title-link" href="{{ is.html or is.xml }}">{{ is.title or "Titill vantar" }}</a>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </details>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </details>
    {% endfor %}
</section>
<script src="{{ url_for('static', filename='js/members_filter.js') }}"></script>
{% endblock %}
